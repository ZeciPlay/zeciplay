// script.js otimizado
const e={heroBanner:document.getElementById("hero-banner"),gameTitleContainer:document.getElementById("game-title-container"),gameDescription:document.getElementById("game-description"),screenshots:document.getElementById("screenshots"),achievementsGrid:document.getElementById("achievements-grid"),toggleAchievementsBtn:document.getElementById("toggle-achievements")};let n,a=new Set,s=[];async function l(){try{const e=await fetch("game-data.json");n=await e.json();c();r();}catch(e){console.error("Error loading game data:",e)}}function c(){const e=n?.game?.title||"default",t=localStorage.getItem(`achievementsProgress_${e}`);t&&(a=new Set(JSON.parse(t).completed||[]))}function r(){if(!n)return;const t=n.game||{};e.heroBanner&&t.banner&&(e.heroBanner.style.background=`linear-gradient(45deg, rgba(0, 0, 0, 0.8), rgba(255, 107, 53, 0.2)), url("${t.banner}") center/cover`);e.gameTitleContainer&&(e.gameTitleContainer.innerHTML=`<div class="game-icon-container"><img src="${t.icon||""}" alt="${t.title||"Game"}" class="game-icon-img"></div><div class="game-title-content"><h3>${t.title||"Game"} <small>(${(t.size||"0MB").toLowerCase()})</small></h3><p class="meta">Version ${t.version||"1.0"}</p></div>`);e.gameDescription&&(e.gameDescription.textContent=t.description||"Description not available.");e.screenshots&&((t.screenshots||[]).length>0?e.screenshots.innerHTML=t.screenshots.map(e=>`<div class="screenshot-item"><img src="${e}" alt="Screenshot" loading="lazy"></div>`).join(""):e.screenshots.innerHTML='<div class="screenshot-placeholder"><span>üì± Screenshots</span></div>');renderSpecifications();i(n.achievements||[])}function renderSpecifications(){if(!n||!n.game||!n.game.specifications)return;const e=document.getElementById("specs-grid");if(!e)return;const t=n.game.specifications;e.innerHTML=[{label:"Architecture",value:t.architecture},{label:"Touch Screen",value:t.ts},{label:"Gamepad",value:t.gamepad},{label:"Keyboard",value:t.keyboard},{label:"Fullscreen",value:t.fullscreen},{label:"Play Time",value:t.playtime},{label:"Release Date",value:t.releaseDate},{label:"Languages",value:t.languages},{label:"Game Type",value:t.gameType}].map(n=>`<div class="spec-item"><span class="spec-label">${n.label}</span><span class="spec-value">${n.value}</span></div>`).join("")}function i(t){if(!e.achievementsGrid)return;t&&t.length>0?(e.achievementsGrid.style.display="none",e.toggleAchievementsBtn&&(e.toggleAchievementsBtn.textContent="Show Achievements",e.toggleAchievementsBtn.onclick=function(){const t="grid"===e.achievementsGrid.style.display;e.achievementsGrid.style.display=t?"none":"grid",e.toggleAchievementsBtn.textContent=t?"Show Achievements":"Hide Achievements"}),e.achievementsGrid.innerHTML=t.map(t=>{const n=a.has(t.id.toString());return`<div class="achievement-item"><button class="achievement-button ${n?"completed":""}" data-id="${t.id}" data-name="${t.name||"Achievement"}" data-description="${t.description||"Description not available"}"><div class="achievement-icon"><img src="${t.image||""}" alt="${t.name||"Achievement"}" class="achievement-icon-img" onerror="this.style.display='none'; this.parentElement.innerHTML='üèÜ';"></div>${n?'<div class="completed-badge">üèÜ</div>':""}</button><div class="achievement-popup"></div></div>`}).join(""),d()):e.achievementsGrid.innerHTML='<div class="no-results">No achievements available.</div>'}function d(){const t=document.getElementById("achievements-grid");if(!t)return;let n,a=null;t.addEventListener("click",e=>{const s=e.target.closest(".achievement-button");if(!s)return;const o=s.getAttribute("data-id"),l=s.closest(".achievement-item"),c=l.querySelector(".achievement-popup"),r="true"===c.getAttribute("data-open");a?(clearTimeout(a),a=null,u(o,s),n&&(h(n),n=null)):(a=setTimeout(()=>{a=null,n&&n!==c&&h(n),r?h(c):(c.innerHTML=`<div class="popup-title">${s.getAttribute("data-name")||"Achievement"}</div><div class="popup-description">${s.getAttribute("data-description")||"Description not available."}</div>`,c.style.display="block",c.setAttribute("data-open","true"),n=c)},300))});document.addEventListener("click",e=>{e.target.closest(".achievement-item")||n&&(h(n),n=null)});document.addEventListener("keydown",e=>{"Escape"===e.key&&n&&(h(n),n=null)});function h(e){e.style.display="none",e.removeAttribute("data-open")}}function u(e,t){if(!e)return;const n=e.toString();a.has(n)?(a.delete(n),t.classList.remove("completed"),t.querySelector(".completed-badge")?.remove()):(a.add(n),t.classList.add("completed"),t.querySelector(".completed-badge")||t.insertAdjacentHTML("beforeend",'<div class="completed-badge">üèÜ</div>'));m()}function m(){const e=n?.game?.title||"default",t={completed:Array.from(a),lastUpdate:new Date().toISOString()};localStorage.setItem(`achievementsProgress_${e}`,JSON.stringify(t))}async function g(){try{const e=await fetch("devices-data.json?nocache="+Date.now());s=(await e.json()).devices||[]}catch(e){console.error("Error loading devices data:",e),s=[]}}function v(){const t=document.getElementById("check-compatibility-btn"),n=document.getElementById("register-compatibility-btn"),a=document.getElementById("compatibility-search"),o=document.getElementById("device-search"),l=document.getElementById("device-results");t&&n&&(a.style.display="none",t.addEventListener("click",()=>{"none"!==a.style.display?a.style.display="none":(a.style.display="block",setTimeout(()=>o?.focus(),100))}),n.addEventListener("click",()=>{window.open("https://docs.google.com/forms/d/e/1FAIpQLSc0kbMVdXsJfVwWBHpqbnX9maEmoAL154TOavCXpG5QRr5xXA/viewform","_blank")}),o&&o.addEventListener("input",e=>{const t=e.target.value.trim().toLowerCase();t.length<2?l&&(l.innerHTML='<div class="no-results">Type 2+ characters...</div>'):b(s.filter(e=>e.name.toLowerCase().includes(t)),l)}))}function b(e,t){t&&(e&&e.length>0?t.innerHTML=e.map(e=>`<div class="device-result"><div class="device-name">${e.name}</div><div class="device-specs"><div class="spec-item"><span class="spec-label">Compatibility</span><span class="spec-value">${e.compatibility}</span></div><div class="spec-item"><span class="spec-label">Game Without Config</span><span class="spec-value">${e.fps_normal}</span></div><div class="spec-item"><span class="spec-label">Game Configured</span><span class="spec-value">${e.fps_configurado}</span></div><div class="spec-item"><span class="spec-label">FPS drops</span><span class="spec-value">${e.quedas_fps}</span></div><div class="spec-item"><span class="spec-label">Reported by</span><span class="spec-value">${e.user||"Unknown"}</span></div></div></div>`).join(""):t.innerHTML='<div class="no-results">No devices found.</div>')}function exportAchievements(){if(!a||0===a.size)return void alert("Nenhuma conquista para exportar!");const e=n?.game?.title||"game",t={completed:Array.from(a),lastUpdate:new Date().toISOString(),game:e,totalAchievements:n.achievements.length,completedCount:a.size},s=JSON.stringify(t,null,2),o=new Blob([s],{type:"application/json"}),l=URL.createObjectURL(o),c=document.createElement("a");c.href=l,c.download=`${e.toLowerCase()}-achievements-${new Date().toISOString().split("T")[0]}.json`,c.click(),URL.revokeObjectURL(l)}function importAchievements(e){const t=new FileReader;t.onload=function(e){try{const t=JSON.parse(e.target.result);if(!t.completed||!Array.isArray(t.completed))throw new Error("Arquivo inv√°lido: formato de conquistas n√£o reconhecido");a=new Set(t.completed),m(),i(n.achievements),alert(`Conquistas importadas com sucesso! ${a.size} conquistas marcadas como completadas.`)}catch(e){alert("Erro ao importar arquivo: "+e.message)}},t.readAsText(e)}document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("export-achievements");e&&e.addEventListener("click",exportAchievements);const t=document.getElementById("import-file");t&&t.addEventListener("change",function(e){e.target.files[0]&&(importAchievements(e.target.files[0]),e.target.value="")}),l(),g().then(()=>v())});